<%- include("../partials/header") %>
<%- include("../partials/navbarAdmin") %>

<main class="p-6 max-w-4xl mx-auto">
  <h1 class="text-3xl font-bold text-[var(--color-primario)] mb-6">Gestión de Eventos</h1>

  <!-- Formulario de creación -->
  <form action="/admin/eventos" method="POST" class="bg-white p-6 rounded-lg shadow-md border border-gray-300 space-y-4 mb-10">
    <div>
      <label for="fecha" class="block text-sm mb-1">Fecha del evento</label>
      <input type="date" name="fecha" id="fecha" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[var(--color-secundario)]">
    </div>

    <div>
      <label for="titulo" class="block text-sm mb-1">Título o descripción</label>
      <input type="text" name="titulo" id="titulo" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[var(--color-secundario)]">
    </div>

    <div>
      <label class="block text-sm mb-1">Color del evento</label>
      <!-- Picker -->
      <input type="color" id="colorPicker" class="w-16 h-10 border-0 cursor-pointer">

      <!-- Favoritos -->
      <div class="flex gap-2 mt-2 text-xs text-gray-500">
        <span>Favoritos:</span>
        <label class="cursor-pointer">
          <input type="radio" name="colorFavorito" value="#2D5A80" class="peer hidden" />
          <span class="inline-block w-5 h-5 rounded-full bg-[#2D5A80] border peer-checked:ring-2 peer-checked:ring-[var(--color-secundario)]"></span>
        </label>
        <label class="cursor-pointer">
          <input type="radio" name="colorFavorito" value="#4CAF50" class="peer hidden" />
          <span class="inline-block w-5 h-5 rounded-full bg-[#4CAF50] border peer-checked:ring-2 peer-checked:ring-[var(--color-secundario)]"></span>
        </label>
        <label class="cursor-pointer">
          <input type="radio" name="colorFavorito" value="#F44336" class="peer hidden" />
          <span class="inline-block w-5 h-5 rounded-full bg-[#F44336] border peer-checked:ring-2 peer-checked:ring-[var(--color-secundario)]"></span>
        </label>
      </div>

      <!-- Input oculto que se enviará -->
      <input type="hidden" name="color" id="colorFinal">
    </div>

    <button type="submit" class="bg-[var(--color-primario)] hover:bg-[var(--color-secundario)] text-white py-2 px-4 rounded">
      Guardar evento
    </button>
  </form>

  <!-- Tabla de eventos -->
  <div class="bg-white p-6 rounded-lg shadow-md border border-gray-300">
    <h2 class="text-xl font-semibold mb-4 text-[var(--color-primario)]">Eventos registrados</h2>

    <% if (eventos.length === 0) { %>
    <p class="text-sm text-gray-500">Aún no se han registrado eventos.</p>
    <% } else { %>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-left border border-gray-200">
        <thead class="bg-[var(--color-fondo-claro)] text-gray-600 border-b">
          <tr>
            <th class="px-4 py-2">Fecha</th>
            <th class="px-4 py-2">Título</th>
            <th class="px-4 py-2">Color</th>
            <th class="px-4 py-2">Creado</th>
          </tr>
        </thead>
        <tbody>
          <% eventos.forEach(evento => { %>
          <tr class="border-t hover:bg-gray-50">
            <td class="px-4 py-2"><%= evento.fecha %></td>
            <td class="px-4 py-2"><%= evento.titulo %></td>
            <td class="px-4 py-2">
              <% if (evento.color && /^#[0-9A-F]{6}$/i.test(evento.color)) { %>
                <span
                  class="inline-block w-5 h-5 rounded-full border"
                  style="background-color: <%= evento.color %>">
                </span>
                <span class="ml-2 text-xs text-gray-500"><%= evento.color %></span>
              <% } else { %>
                <span class="text-xs text-gray-400 italic">Sin color</span>
              <% } %>
            </td>
            <td class="px-4 py-2 text-xs text-gray-500">
              <%= new Date(evento.created_at).toLocaleDateString("es-EC", { day: "2-digit", month: "2-digit", year: "numeric" }) %>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</main>

<!-- Script Eventos -->
<script src="/js/eventos.js"></script>
<!-- Footer -->
<%- include("../partials/footer") %>